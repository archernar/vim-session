#!/usr/bin/ksh
Tmp="/tmp/$$"
TmpDir="/tmp/dir$$"
trap 'rm -f "$Tmp" >/dev/null 2>&1' 0
trap "exit 2" 1 2 3 13 15
rm $Tmp  >/dev/null 2>&1
export AWKPATH=/home/mestes/scm/cuu

# #######################################
# #######################################
confirm() {
      print -n "Enter '10111' to confirm >> "
      read STRIN
      if [ "$STRIN" != "10111" ] ; then
           print "   Exiting - No Match"
           exit 1
      fi
}
# #######################################
REPO=vim-session
LOCAL=""
while getopts "plk" arg
do
	case $arg in
            p) print "Force push origin to master"
               confirm 
               git push -u origin master
               exit 0 
               ;;
            k) confirm 
               rm -rf cp $HOME/.vim/bundle/$REPO
               exit 0 
               ;;
            l) LOCAL="yes" 
               ;;
        esac
done
ANON=`date`
print $ANON
print "Local Deployment..."
cp plugin/session.vim $HOME/.vim/bundle/$REPO/plugin/session.vim
cp plugin/dir.vim $HOME/.vim/bundle/$REPO/plugin/dir.vim
cp tools/vit ~/firstbin/vit
cp tools/vi  ~/firstbin/vi
cp ~/.vimrc   tools/.vimrc 

if [ "$LOCAL" == "yes" ] ; then
    print "Local Deployment Only"
    exit 0
fi


if [ "$PUSHITLOCAL" == "LOCAL" ] ; then
     LOCAL="LOCAL"
fi

print "Building README.md"

print "# vim-session" > README.md
print "Simple Vim session management" >> README.md
print "" >> README.md

print "## Screen Shot" >> README.md
print  "![alt text](https://github.com/archernar/vim-session/blob/master/images/session.png)" >> README.md
print "" >> README.md
print "## DIR Command (simple file selector)" >> README.md
print  "![alt text](https://github.com/archernar/vim-session/blob/master/images/dirsession.png)" >> README.md
print "" >> README.md

print "## session.vim" >> README.md
cat plugin/session.vim | gawk '{print "    " $0}' | markdown >> README.md
cat plugin/dir.vim | gawk '{print "    " $0}' | markdown >> README.md

print "## Example Integration:  vit (Adv. model)" >> README.md
print "" >> README.md
cat tools/vit | gawk '{print "    " $0}' >> README.md

print "## Example Integration: vi (simple model)" >> README.md
print "" >> README.md
cat tools/vi | gawk '{print "    " $0}' >> README.md



          git add plugin/session.vim
          git add plugin/dir.vim
          git add tools/vit
          git add tools/vi
          git add tools/.vimrc
          git add images/session.png
          git add images/dirsession.png
          git add pushit
          git add README.md
          git commit -m "Update"

if [ "$LOCAL" == "" ] ; then
     IP=192.168.1.1
     fping -c1 -t300 $IP 2>/dev/null 1>/dev/null
     if [ $? -eq 0 ] ; then
          git push -u origin master
     fi
fi

